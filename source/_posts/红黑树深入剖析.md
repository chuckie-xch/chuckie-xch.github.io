---
title: 红黑树深入剖析
date: 2018-03-16 15:57:32
tags: 数据结构
---

红黑数是一种平衡的二叉搜索树，因此我们从二叉树开始讨论。

**BST**

二叉查找树（BST）是一二叉树，左节点比父结点的值小。因此，查找的复杂度取决于树的高度，理想情况下，二叉树的增删改查的时间复杂度是O（logN）（N为结点数），最坏的情况下是O（N）,当高度为logN+1得时候，这颗二叉树就是平衡二叉树。

<!-- more -->

**BST存在的缺陷**

不同的插入顺序导致树的的高度不同，查找的复杂度就会差异很大，假如所有几点都在一条斜线上，那么高度是N。



### 红黑树

#### 性质

* 结点非黑即白。
* 根结点是黑色的。
* 每个叶子结点都是黑色的。
* 每个红色结点的两个子结点都是黑色的。(从每个叶子到根的所有路径上不能有两个连续的红色节点)
* 每个结点向下遍历到其子孙 结点，所经过的黑色结点数相同。

下图中的树，就是一个棵典型的红黑数：

[![红黑树.png](https://i.loli.net/2018/03/16/5aab6c30e4ca3.png)](https://i.loli.net/2018/03/16/5aab6c30e4ca3.png)



#### 红黑数的数据结构

```java
private static final boolean RED   = false;
private static final boolean BLACK = true;

class  Node<T>{
      T value;
      Node<T> parent;
      boolean color = BLACK;
      Node<T> left;
      Node<T> right;
}
```



#### 红黑数的变色和旋转

变色和旋转是为了使得红黑树符合其原本的性质。

上图中，我们向红黑树中插入一个数21时：

[![规则破坏.png](https://i.loli.net/2018/03/16/5aab6d72433dd.png)](https://i.loli.net/2018/03/16/5aab6d72433dd.png)

就破坏了路径上不能存在连续两个红色结点的性质。

**变色：**

为了重新符合红黑树的性质，尝试把红色节点变为黑色，或者把黑色节点变为红色。

先把22结点变成黑色。

[![22结点变色.png](https://i.loli.net/2018/03/16/5aab72f5cbb24.png)](https://i.loli.net/2018/03/16/5aab72f5cbb24.png)

继续把25结点变成红色。

[![25结点变色.png](https://i.loli.net/2018/03/16/5aab734da8d16.png)](https://i.loli.net/2018/03/16/5aab734da8d16.png)

依然不符合规则，继续将27结点变色。

[![27结点变色.png](https://i.loli.net/2018/03/16/5aab7383a7930.png)](https://i.loli.net/2018/03/16/5aab7383a7930.png)



**左旋：**

**逆时针**旋转两个结点，使得父节点被右孩子取代，自己成为自己的左孩子。如图：

[![左旋.png](https://i.loli.net/2018/03/16/5aab6f837ec97.png)](https://i.loli.net/2018/03/16/5aab6f837ec97.png)



**右旋：**

**顺时针**旋转两个子结点，使得父节点被左孩子取代，自己成为自己的右孩子。如图：

[![右旋.png](https://i.loli.net/2018/03/16/5aab70cbd2ff7.png)](https://i.loli.net/2018/03/16/5aab70cbd2ff7.png)



经过上面的变色，现在仍然不符合规则：

[![无法变色.png](https://i.loli.net/2018/03/16/5aab73dca6882.png)](https://i.loli.net/2018/03/16/5aab73dca6882.png)

此时如果继续变色，将17变为黑色，13变为红色，就打破了根结点必须是黑色的规则。所以，该是旋转上场的时候了^o^....

13结点和17结点左旋：

[![根结点左旋.png](https://i.loli.net/2018/03/16/5aab75476094d.png)](https://i.loli.net/2018/03/16/5aab75476094d.png)

接着，变色：

[![左旋后变色.png](https://i.loli.net/2018/03/16/5aab75811baf2.png)](https://i.loli.net/2018/03/16/5aab75811baf2.png)

这样依然没有结束，17->8->6->NIL的黑色结点数是4，而根结点到其他的叶子节点的黑色结点数为3,所以，对13结点和8结点进行右旋：

[![13和8结点右旋.png](https://i.loli.net/2018/03/16/5aab77b9adc92.png)](https://i.loli.net/2018/03/16/5aab77b9adc92.png)

然后变色：

[![result.png](https://i.loli.net/2018/03/16/5aab7818e7309.png)](https://i.loli.net/2018/03/16/5aab7818e7309.png)

至此，插入修复操作便完成了，整个数依然符合红黑树的性质。